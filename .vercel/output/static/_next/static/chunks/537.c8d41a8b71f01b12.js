"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[537],{9537:function(e,n,s){s.r(n),s.d(n,{default:function(){return v}});var l=s(4924),t=s(6042),r=s(9396),i=s(5893),a=s(7294),c=s(5979),o=s.n(c),d=s(1983),u=s(6022);function f(e){var n=e.registerDetail,s=e.handleRegister,l=e.handleUnRegister,t=e.handleRegisterDetailChange,r=e.handleCall,a=e.handleHangUp;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"form-control w-full ",children:[(0,i.jsx)("label",{className:"label",children:(0,i.jsx)("span",{className:"label-text text-xs",children:"Domain"})}),(0,i.jsx)(d.II,{className:"w-full",size:"xs",value:n.server,onChange:function(e){return t("server",e.target.value)},placeholder:"server",disabled:n.isRegister})]}),(0,i.jsxs)("div",{className:"form-control w-full ",children:[(0,i.jsx)("label",{className:"label",children:(0,i.jsx)("span",{className:"label-text text-xs",children:"Websocket"})}),(0,i.jsx)(d.II,{className:"w-full",size:"xs",value:n.websocket,onChange:function(e){return t("websocket",e.target.value)},placeholder:"websocket",disabled:n.isRegister})]}),(0,i.jsxs)("div",{className:"form-control w-full ",children:[(0,i.jsx)("label",{className:"label",children:(0,i.jsx)("span",{className:"label-text text-xs",children:"Extension"})}),(0,i.jsx)(d.II,{className:"w-full",size:"xs",value:n.extension,onChange:function(e){return t("extension",e.target.value)},placeholder:"extension",disabled:n.isRegister})]}),(0,i.jsxs)("div",{className:"form-control w-full mb-2",children:[(0,i.jsx)("label",{className:"label",children:(0,i.jsx)("span",{className:"label-text text-xs ",children:"Password"})}),(0,i.jsx)(d.II,{className:"w-full",size:"xs",value:n.password,onChange:function(e){return t("password",e.target.value)},placeholder:"password",disabled:n.isRegister})]}),(0,i.jsx)("button",{className:"btn btn-info w-full m-2",disabled:n.isRegister,onClick:s,children:"Register"}),(0,i.jsx)("button",{className:"btn btn-error w-full m-2",disabled:!n.isRegister,onClick:l,children:"Unregister"}),(0,i.jsx)(d.l0,{className:"w-full mb-2",children:(0,i.jsxs)(d.BZ,{className:"w-full",children:[(0,i.jsx)("span",{children:(0,i.jsx)(u.Z,{})}),(0,i.jsx)(d.II,{type:"text",placeholder:"Type here",className:"input input-bordered input-info w-full text-center",value:n.destination,onChange:function(e){return t("destination",e.target.value)},bordered:!0})]})}),(0,i.jsx)("button",{className:"btn btn-success w-full m-2",onClick:r,children:"Call"}),(0,i.jsx)("button",{className:"btn btn-warning w-full m-2",onClick:a,children:"HangUp"})]})}var x=s(1170);function m(e){var n=e.handleMuteVideo,s=e.callOutRef,l=e.localVideoRef,t=e.remoteVideoRef,r=(0,a.useRef)(null);return(0,i.jsxs)("div",{className:"flex mt-2 flex-col w-full max-w-full h-[calc(100%-30px)]",children:[(0,i.jsx)("div",{className:"fixed top-[40%] left-1/2 justify-center items-center text-6xl",ref:s}),(0,i.jsx)("div",{className:"flex flex-1 h-1/2 w-full self-center items-center justify-center pb-2",children:(0,i.jsxs)("div",{className:"flex h-full items-center justify-center rounded-2xl animate__animated animate__zoomIn",onMouseOver:function(){r.current.classList.replace("hidden","fixed")},onMouseLeave:function(){r.current.classList.replace("fixed","hidden")},children:[(0,i.jsx)("div",{className:"hidden p-2 rounded-xl cursor-pointer bg-slate-200 z-50",ref:r,onClick:n,children:(0,i.jsx)(x.Z,{})}),(0,i.jsx)("video",{autoPlay:!0,playsInline:!0,ref:l,className:"w-full h-full rounded-2xl hidden",muted:!0})]})}),(0,i.jsx)("div",{className:"flex flex-1 h-1/2 w-full self-center items-center justify-center pt-2",children:(0,i.jsx)("div",{className:"flex h-full items-center justify-center rounded-2xl animate__animated animate__zoomIn ",children:(0,i.jsx)("video",{autoPlay:!0,playsInline:!0,ref:t,className:"w-full h-full rounded-2xl hidden"})})})]})}function h(e){var n=e.isIncoming,s=e.handleAcceptCall,l=e.handleDeclineCall;return(0,i.jsxs)(d.u_,{open:n,children:[(0,i.jsx)(d.u_.Header,{className:"font-bold",children:"Incoming Call"}),(0,i.jsxs)(d.u_.Actions,{children:[(0,i.jsx)(d.zx,{onClick:l,color:"error",children:"Decline"}),(0,i.jsx)(d.zx,{onClick:s,color:"success",children:"Accept"})]})]})}var g=null,p=null,j={audio:!0,video:!0},b=[{urls:"turn:turn.ttrs.in.th?transport=tcp",username:"turn01",credential:"Test1234"}];function v(){var e=(0,a.useRef)(null),n=(0,a.useRef)(null),s=(0,a.useRef)(null),c=(0,a.useRef)(null),d=(0,a.useRef)(null),u=(0,a.useState)({server:"test-135-sip.ttrs.in.th",websocket:"wss://test-135-sip.ttrs.in.th:443/ws",extension:"User2",password:"test1234",isRegister:!1,destination:"9999"}),x=u[0],v=u[1],w=(0,a.useState)(!1),N=w[0],C=w[1],R=(0,a.useState)({video:!0,audio:!0});R[0],R[1];(0,a.useEffect)((function(){null!==localStorage.getItem("registerDetail")&&v(JSON.parse(localStorage.getItem("registerDetail")))}),[]);var I=function(e){d.current.className="fixed bottom-0 h-[10px] w-full "+e};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"flex flex-row h-screen w-screen bg-slate-200",children:[(0,i.jsxs)("div",{className:"flex w-1/4 min-w-[250px] mx-3 flex-col items-center self-start",children:[(0,i.jsx)(f,{registerDetail:x,handleRegister:function(){localStorage.setItem("registerDetail",JSON.stringify(x)),function(){console.log("registerSip");var e={sockets:[new(o().WebSocketInterface)(x.websocket)],uri:"sip:"+x.extension+"@"+x.server,password:x.password};(g=new(o().UA)(e)).start(),g.on("registered",(function(e){v((function(e){return(0,r.Z)((0,t.Z)({},e),{isRegister:!0})})),I("bg-green-500")})),g.on("unregistered",(function(e){I("bg-red-500"),console.log(e)})),g.on("registrationFailed",(function(e){})),g.on("newRTCSession",(function(e){console.log(" *** newRTCSession",e.originator,e.request.method,e),p=e.session,"remote"===e.originator&&(console.log(e.originator),C(!0)),p.on("ended",(function(){})),p.on("confirmed",(function(){})),p.on("peerconnection",(function(n){console.log(" *** peerconnection",e.originator,n,n.peerconnection),n.peerconnection.onaddstream=function(n){console.log(e),c.current.srcObject=n.stream,c.current.classList.remove("hidden")},n.peerconnection.onremovestream=function(e){c.current.stop(),c.current.srcObject=null,s.current.srcObject=null}}))}))}()},handleUnRegister:function(){g.stop(),v((function(e){return(0,r.Z)((0,t.Z)({},e),{isRegister:!1})}))},handleRegisterDetailChange:function(e,n){v((function(s){return(0,r.Z)((0,t.Z)({},s),(0,l.Z)({},e,n))}))},handleCall:function(){try{e.current.innerText="Call "+x.destination,function(){var l={eventHandlers:{progress:function(n){e.current.innerText="Call "+x.destination,console.log("call is in progress")},failed:function(s){e.current.innerText=s.cause,n.current.innerText=s.cause,console.log("call failed with cause: "+s)},ended:function(e){console.log("call ended with cause: "+e),s.current.classList.add("hidden"),c.current.classList.add("hidden")},confirmed:function(l){console.log("call confirmed"),n.current.innerText="",e.current.innerText="",s.current.srcObject=t.connection.getLocalStreams()[0],s.current.classList.remove("hidden")},muted:function(e){console.log(e)}},mediaConstraints:j,pcConfig:{iceServers:b}},t=g.call("sip:"+x.destination+"@"+x.server,l);t.connection.addEventListener("addstream",(function(e){console.log(e),c.current.srcObject=e.stream,c.current.classList.remove("hidden")}))}()}catch(l){console.log(l)}},handleHangUp:function(){try{p.terminate()}catch(e){console.log(e)}}}),(0,i.jsx)("div",{ref:n})]}),(0,i.jsx)(m,{handleMuteVideo:function(){p.mute({video:!0})},destination:x.destination,callOutRef:e,localVideoRef:s,remoteVideoRef:c}),(0,i.jsx)(h,{isIncoming:N,handleAcceptCall:function(){console.log(p),p.answer({mediaConstraints:j,pcConfig:{iceServers:b}}),C(!1)},handleDeclineCall:function(){p.terminate(),C(!1)}})]}),(0,i.jsx)("div",{className:"fixed bottom-0 w-full h-[10px] ",ref:d})]})}}}]);