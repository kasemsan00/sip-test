"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[638],{1638:function(e,n,s){s.r(n),s.d(n,{default:function(){return v}});var l=s(4924),t=s(6042),r=s(9396),i=s(5893),a=s(7294),c=s(5979),o=s.n(c),d=s(1983),u=s(6022);function f(e){var n=e.registerDetail,s=e.handleRegister,l=e.handleUnRegister,t=e.handleRegisterDetailChange,r=e.handleCall,a=e.handleHangUp;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"w-full text-3xl",children:"Register Detail"}),(0,i.jsxs)("div",{className:"form-control w-full ",children:[(0,i.jsx)("label",{className:"label",children:(0,i.jsx)("span",{className:"label-text",children:"Domain"})}),(0,i.jsx)(d.II,{className:"w-full",value:n.server,onChange:function(e){return t("server",e.target.value)},placeholder:"server",disabled:n.isRegister})]}),(0,i.jsxs)("div",{className:"form-control w-full ",children:[(0,i.jsx)("label",{className:"label",children:(0,i.jsx)("span",{className:"label-text",children:"Websocket"})}),(0,i.jsx)(d.II,{className:"w-full",value:n.websocket,onChange:function(e){return t("websocket",e.target.value)},placeholder:"websocket",disabled:n.isRegister})]}),(0,i.jsxs)("div",{className:"form-control w-full ",children:[(0,i.jsx)("label",{className:"label",children:(0,i.jsx)("span",{className:"label-text",children:"Extension"})}),(0,i.jsx)(d.II,{className:"w-full",value:n.extension,onChange:function(e){return t("extension",e.target.value)},placeholder:"extension",disabled:n.isRegister})]}),(0,i.jsxs)("div",{className:"form-control w-full mb-2",children:[(0,i.jsx)("label",{className:"label",children:(0,i.jsx)("span",{className:"label-text",children:"Password"})}),(0,i.jsx)(d.II,{className:"w-full",value:n.password,onChange:function(e){return t("password",e.target.value)},placeholder:"password",disabled:n.isRegister})]}),(0,i.jsx)("button",{className:"btn btn-info w-full m-2",disabled:n.isRegister,onClick:s,children:"Register"}),(0,i.jsx)("button",{className:"btn btn-error w-full m-2",disabled:!n.isRegister,onClick:l,children:"Unregister"}),(0,i.jsx)("div",{className:"w-full text-3xl mt-5",children:"Call"}),(0,i.jsx)(d.l0,{className:"w-full mb-2",children:(0,i.jsxs)(d.BZ,{className:"w-full",children:[(0,i.jsx)("span",{children:(0,i.jsx)(u.Z,{})}),(0,i.jsx)(d.II,{type:"text",placeholder:"Type here",className:"input input-bordered input-info w-full text-center",value:n.destination,onChange:function(e){return t("destination",e.target.value)},bordered:!0})]})}),(0,i.jsx)("button",{className:"btn btn-success w-full m-2",onClick:r,children:"Call"}),(0,i.jsx)("button",{className:"btn btn-warning w-full m-2",onClick:a,children:"HangUp"})]})}function m(e){var n=e.callOutRef,s=e.localVideoRef,l=e.remoteVideoRef;return(0,i.jsxs)("div",{className:"flex m-4 flex-col w-full max-w-full h-[calc(100%-30px)]",children:[(0,i.jsx)("div",{className:"fixed top-[40%] left-1/2 justify-center items-center text-6xl",ref:n}),(0,i.jsx)("div",{className:"flex flex-1 h-1/2 w-full self-center items-center justify-center pb-2",children:(0,i.jsx)("div",{className:"flex h-full items-center justify-center rounded-2xl animate__animated animate__zoomIn ",children:(0,i.jsx)("video",{autoPlay:!0,playsInline:!0,ref:s,className:"w-full h-full rounded-2xl hidden",muted:!0})})}),(0,i.jsx)("div",{className:"flex flex-1 h-1/2 w-full self-center items-center justify-center pt-2",children:(0,i.jsx)("div",{className:"flex h-full items-center justify-center rounded-2xl animate__animated animate__zoomIn ",children:(0,i.jsx)("video",{autoPlay:!0,playsInline:!0,ref:l,className:"w-full h-full rounded-2xl hidden"})})})]})}function x(e){var n=e.isIncoming,s=e.handleAcceptCall,l=e.handleDeclineCall;return(0,i.jsxs)(d.u_,{open:n,children:[(0,i.jsx)(d.u_.Header,{className:"font-bold",children:"Incoming Call"}),(0,i.jsxs)(d.u_.Actions,{children:[(0,i.jsx)(d.zx,{onClick:l,color:"error",children:"Decline"}),(0,i.jsx)(d.zx,{onClick:s,color:"success",children:"Accept"})]})]})}var h=null,g=null,j={audio:!0,video:!0},p=[{urls:"turn:turn.ttrs.in.th?transport=tcp",username:"turn01",credential:"Test1234"}];function v(){var e=(0,a.useRef)(null),n=(0,a.useRef)(null),s=(0,a.useRef)(null),c=(0,a.useRef)(null),d=(0,a.useRef)(null),u=(0,a.useState)({server:"test-135-sip.ttrs.in.th",websocket:"wss://test-135-sip.ttrs.in.th:443/ws",extension:"User2",password:"test1234",isRegister:!1,destination:"9999"}),v=u[0],b=u[1],w=(0,a.useState)(!1),N=w[0],C=w[1];(0,a.useEffect)((function(){null!==localStorage.getItem("registerDetail")&&b(JSON.parse(localStorage.getItem("registerDetail")))}),[]);var R=function(e){d.current.className="progress w-full "+e};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"flex flex-row h-screen w-screen bg-slate-200",children:[(0,i.jsxs)("div",{className:"flex w-1/4 m-3 flex-col items-center self-start",children:[(0,i.jsx)(f,{registerDetail:v,handleRegister:function(){localStorage.setItem("registerDetail",JSON.stringify(v)),function(){console.log("registerSip");var e={sockets:[new(o().WebSocketInterface)(v.websocket)],uri:"sip:"+v.extension+"@"+v.server,password:v.password};(h=new(o().UA)(e)).start(),h.on("registered",(function(e){b((function(e){return(0,r.Z)((0,t.Z)({},e),{isRegister:!0})})),R("progress-success")})),h.on("unregistered",(function(e){console.log(e)})),h.on("registrationFailed",(function(e){})),h.on("newRTCSession",(function(e){console.log(" *** newRTCSession",e.originator,e.request.method,e),g=e.session,"remote"===e.originator&&(console.log(e.originator),C(!0)),g.on("ended",(function(){s.current.classList.add("hidden"),c.current.classList.add("hidden")})),g.on("confirmed",(function(){s.current.srcObject=g.connection.getLocalStreams()[0],s.current.classList.remove("hidden")})),g.on("peerconnection",(function(n){console.log(" *** peerconnection",e.originator,n,n.peerconnection),n.peerconnection.onaddstream=function(n){console.log(e),c.current.srcObject=n.stream,c.current.classList.remove("hidden")},n.peerconnection.onremovestream=function(e){c.current.stop(),c.current.srcObject=null,s.current.srcObject=null}}))}))}()},handleUnRegister:function(){h.stop(),b((function(e){return(0,r.Z)((0,t.Z)({},e),{isRegister:!1})}))},handleRegisterDetailChange:function(e,n){b((function(s){return(0,r.Z)((0,t.Z)({},s),(0,l.Z)({},e,n))}))},handleCall:function(){try{e.current.innerText="Call "+v.destination,function(){var l={eventHandlers:{progress:function(n){e.current.innerText="Call "+v.destination,console.log("call is in progress")},failed:function(s){e.current.innerText=s.cause,n.current.innerText=s.cause,console.log("call failed with cause: "+s)},ended:function(e){console.log("call ended with cause: "+e),s.current.classList.add("hidden"),c.current.classList.add("hidden")},confirmed:function(l){console.log("call confirmed"),n.current.innerText="",e.current.innerText="",s.current.srcObject=t.connection.getLocalStreams()[0],s.current.classList.remove("hidden")}},mediaConstraints:j,pcConfig:{iceServers:p}},t=h.call("sip:"+v.destination+"@"+v.server,l);t.connection.addEventListener("addstream",(function(e){console.log(e),c.current.srcObject=e.stream,c.current.classList.remove("hidden")}))}()}catch(l){console.log(l)}},handleHangUp:function(){try{g.terminate()}catch(e){console.log(e)}}}),(0,i.jsx)("div",{ref:n}),(0,i.jsx)("progress",{className:"progress w-full",value:100,ref:d})]}),(0,i.jsx)(m,{destination:v.destination,callOutRef:e,localVideoRef:s,remoteVideoRef:c})]}),(0,i.jsx)(x,{isIncoming:N,handleAcceptCall:function(){console.log(g),g.answer({mediaConstraints:j,pcConfig:{iceServers:p}}),C(!1)},handleDeclineCall:function(){g.terminate(),C(!1)}})]})}}}]);